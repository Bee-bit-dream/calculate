<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>감자와 호박 산출기</title>
    <style>
        #record {
            display: none; /* 기본적으로 숨김 */
            border: 1px solid #ccc;
            padding: 10px;
            margin-top: 10px;
        }
        .toggle-button {
            cursor: pointer;
            color: blue;
            text-decoration: underline;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
    <script>
        let records = JSON.parse(localStorage.getItem("records")) || []; // Local Storage에서 기록 불러오기

        function toggleRecord() {
            const recordDiv = document.getElementById("record");
            recordDiv.style.display = recordDiv.style.display === "none" ? "block" : "none";
        }

        function updateOptions() {
            const item = document.getElementById("item").value;
            const waterSelect = document.getElementById("water");
            const weedSelect = document.getElementById("weed");

            // 선택 항목에 따라 물주기와 잡초뽑기 옵션 업데이트
            if (item === "감자") {
                updateSelect(waterSelect, 5);
                updateSelect(weedSelect, 5);
            } else if (item === "호박") {
                updateSelect(waterSelect, 7);
                updateSelect(weedSelect, 7);
            }
        }

        function updateSelect(selectElement, max) {
            selectElement.innerHTML = ""; // 기존 옵션 제거
            for (let i = 0; i <= max; i++) {
                let option = document.createElement("option");
                option.value = i;
                option.text = i;
                selectElement.add(option);
            }
        }

        function calculate() {
            const item = document.getElementById("item").value;
            const waterCount = parseInt(document.getElementById("water").value);
            const weedCount = parseInt(document.getElementById("weed").value);
            const playerName = document.getElementById("player").value;
            const creatorName = document.getElementById("creator").value;

            // 랜덤 값 계산
            let waterSum = 0;
            const waterValues = [];
            for (let i = 0; i < waterCount; i++) {
                const value = Math.floor(Math.random() * 30) + 1;
                waterSum += value;
                waterValues.push(value); // 랜덤 값을 저장
            }

            let weedSum = 0;
            const weedValues = [];
            for (let i = 0; i < weedCount; i++) {
                const value = Math.floor(Math.random() * 11) + 5;
                weedSum += value;
                weedValues.push(value); // 랜덤 값을 저장
            }

            const total = waterSum + weedSum;

            // 현재 날짜 및 시간 가져오기
            const now = new Date();
            const dateTime = now.toLocaleString(); // "YYYY/MM/DD HH:MM:SS" 형식

            // 간단한 결괏값 출력
            document.getElementById("result").innerText = `물주기 합계: ${waterSum}, 잡초뽑기 합계: ${weedSum}`;
            
            // 🌟 결과 계산
            let stars = "🌟";
            if (total > 200) {
                stars = "🌟🌟🌟";
            } else if (total > 100) {
                stars = "🌟🌟";
            }
            document.getElementById("finalResult").innerText = `결과: ${stars}`;

            // 산출 기록 저장
            const record = { dateTime, creator: creatorName, player: playerName, item, waterSum, weedSum, total, stars, waterValues, weedValues };
            records.push(record);
            localStorage.setItem("records", JSON.stringify(records)); // Local Storage에 기록 저장
            updateRecordDisplay();
        }

        function updateRecordDisplay() {
            const recordDiv = document.getElementById("record");
            recordDiv.innerHTML = ""; // 기존 기록 제거

            // 표 생성
            const table = document.createElement("table");
            const headerRow = document.createElement("tr");
            headerRow.innerHTML = "<th>날짜 및 시간</th><th>산출자</th><th>플레이어</th><th>작물</th><th>물주기 합계</th><th>잡초뽑기 합계</th><th>총합</th><th>결과</th><th>물주기 값</th><th>잡초뽑기 값</th>";
            table.appendChild(headerRow);

            records.forEach(record => {
                const row = document.createElement("tr");
                row.innerHTML = `<td>${record.dateTime}</td><td>${record.creator}</td><td>${record.player}</td><td>${record.item}</td><td>${record.waterSum}</td><td>${record.weedSum}</td><td>${record.total}</td><td>${record.stars}</td><td>${record.waterValues.join(", ")}</td><td>${record.weedValues.join(", ")}</td>`;
                table.appendChild(row);
            });

            recordDiv.appendChild(table);
        }

        // 페이지 로드 시 기록과 기본 선택 항목 업데이트
        window.onload = function() {
            updateRecordDisplay(); // 저장된 기록 표시
            updateOptions(); // 기본 선택 항목 업데이트
        };
    </script>
</head>
<body>
    <h1>감자와 호박 산출기</h1>

    <label for="creator">산출자:</label>
    <input type="text" id="creator" placeholder="산출자 이름을 입력하세요">
    <br><br>

    <label for="player">플레이어:</label>
    <input type="text" id="player" placeholder="플레이어 이름을 입력하세요">
    <br><br>

    <label for="item">작물 선택:</label>
    <select id="item" onchange="updateOptions()">
        <option value="감자">감자</option>
        <option value="호박">호박</option>
    </select>
    <br><br>

    <label for="water">물주기 횟수 선택:</label>
    <select id="water">
        <!-- 업데이트를 위해 비워둠 -->
    </select>
    <br><br>

    <label for="weed">잡초뽑기 횟수 선택:</label>
    <select id="weed">
        <!-- 업데이트를 위해 비워둠 -->
    </select>
    <br><br>

    <button onclick="calculate()">결과 계산</button>
    <br><br>

    <h3 id="result"></h3>
    <h3 id="finalResult"></h3>

    <div>
        <span class="toggle-button" onclick="toggleRecord()">산출 기록 보기</span>
        <div id="record">
            <!-- 산출 기록이 여기에 추가됩니다 -->
        </div>
    </div>
</body>
</html>
