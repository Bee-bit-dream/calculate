<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë†ì‘ë¬¼ ê³„ì‚°ê¸°</title>
    <style>
        #record {
            display: none; /* ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€ */
            border: 1px solid #ccc;
            padding: 10px;
            margin-top: 10px;
        }
        .toggle-button {
            cursor: pointer;
            color: blue;
            text-decoration: underline;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
            <a href="weather.html">ë‚ ì”¨ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°</a>
    <script>
        let records = JSON.parse(localStorage.getItem("records")) || []; // Local Storageì—ì„œ ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸°

        function toggleRecord() {
            const recordDiv = document.getElementById("record");
            recordDiv.style.display = recordDiv.style.display === "none" ? "block" : "none";
        }

        function updateOptions() {
            const item = document.getElementById("item").value;
            const waterSelect = document.getElementById("water");
            const weedSelect = document.getElementById("weed");
            const fertilizerSelect = document.getElementById("fertilizer");
            const nutrientSelect = document.getElementById("nutrient");
            const weatherSelects = document.querySelectorAll(".weather-select");

            // ì„ íƒ í•­ëª©ì— ë”°ë¼ ë¬¼ì£¼ê¸°ì™€ ì¡ì´ˆë½‘ê¸°, ë¹„ë£Œ, ì˜ì–‘ì œ ì˜µì…˜ ì—…ë°ì´íŠ¸
            let maxWater, maxWeed, maxFertilizer;
            if (item === "ì˜¤ì´") {
                maxWater = maxWeed = maxFertilizer = 2;
            } else if (item === "ìˆœë¬´") {
                maxWater = maxWeed = maxFertilizer = 3;
            } else if (item === "ë¹„íŠ¸") {
                maxWater = 4; maxWeed = maxFertilizer = 3;
            } else if (item === "ë‹¹ê·¼" || item === "í† ë§ˆí† ") {
                maxWater = maxWeed = maxFertilizer = 4;
            } else if (item === "ê°ì") {
                maxWater = maxWeed = maxFertilizer = 5;
            }

            updateSelect(waterSelect, maxWater);
            updateSelect(weedSelect, maxWeed);
            updateSelect(fertilizerSelect, maxFertilizer);
            updateSelect(nutrientSelect, 2);

            // ë‚ ì”¨ ì˜µì…˜ ì—…ë°ì´íŠ¸
            weatherSelects.forEach(select => updateSelect(select, maxFertilizer));
        }

        function updateSelect(selectElement, max) {
            selectElement.innerHTML = ""; // ê¸°ì¡´ ì˜µì…˜ ì œê±°
            for (let i = 0; i <= max; i++) {
                let option = document.createElement("option");
                option.value = i;
                option.text = i;
                selectElement.add(option);
            }
        }

        function calculate() {
            const item = document.getElementById("item").value;
            const waterCount = parseInt(document.getElementById("water").value);
            const weedCount = parseInt(document.getElementById("weed").value);
            const fertilizerCount = parseInt(document.getElementById("fertilizer").value);
            const nutrientCount = parseInt(document.getElementById("nutrient").value);
            const weatherCounts = Array.from(document.querySelectorAll(".weather-select")).map(select => parseInt(select.value));
            const playerName = document.getElementById("player").value;
            const creatorName = document.getElementById("creator").value;

            // ëœë¤ ê°’ ê³„ì‚°
            let waterSum = 0;
            const waterValues = [];
            for (let i = 0; i < waterCount; i++) {
                const value = Math.floor(Math.random() * 30) + 1;
                waterSum += value;
                waterValues.push(value); // ëœë¤ ê°’ì„ ì €ì¥
            }

            let weedSum = 0;
            const weedValues = [];
            for (let i = 0; i < weedCount; i++) {
                const value = Math.floor(Math.random() * 11) + 5;
                weedSum += value;
                weedValues.push(value); // ëœë¤ ê°’ì„ ì €ì¥
            }

            // ë‚ ì”¨ì— ë”°ë¥¸ ìˆ˜ì • ê°’
            let weatherSum = 0;
            weatherCounts.forEach((count, index) => {
                if (index === 0) { // ë§‘ìŒ
                    weatherSum += count * 10;
                } else { // íë¦¼ ë° ë²ˆê°œ
                    weatherSum -= count * 10;
                }
            });

            // ë¹„ë£Œ ë° ì˜ì–‘ì œ ê°’ ê³„ì‚°
            let nutrientSum = nutrientCount * 10;
            let fertilizerSum = fertilizerCount * 5;
            let total = waterSum + weedSum + weatherSum + nutrientSum + fertilizerSum;

            // ë³„ ë“±ê¸‰ ë° í”¼ìŠ¤ ê³„ì‚°
            let stars, pieces;

            if (item === "ì˜¤ì´") {
                if (total <= 40) {
                    stars = "â­ï¸"; pieces = 300;
                } else if (total <= 55) {
                    stars = "â­ï¸â­ï¸"; pieces = 330;
                } else if (total <= 80) {
                    stars = "â­ï¸â­ï¸â­ï¸"; pieces = 360;
                } else {
                    stars = "â¤ï¸"; pieces = 390;
                }
            } else if (item === "ìˆœë¬´") {
                if (total <= 60) {
                    stars = "â­ï¸"; pieces = 400;
                } else if (total <= 110) {
                    stars = "â­ï¸â­ï¸"; pieces = 440;
                } else if (total <= 150) {
                    stars = "â­ï¸â­ï¸â­ï¸"; pieces = 480;
                } else {
                    stars = "â¤ï¸"; pieces = 520;
                }
            } else if (item === "ë¹„íŠ¸") {
                if (total <= 50) {
                    stars = "â­ï¸"; pieces = 400;
                } else if (total <= 100) {
                    stars = "â­ï¸â­ï¸"; pieces = 440;
                } else if (total <= 140) {
                    stars = "â­ï¸â­ï¸â­ï¸"; pieces = 480;
                } else {
                    stars = "â¤ï¸"; pieces = 520;
                }
            } else if (item === "ë‹¹ê·¼") {
                if (total <= 60) {
                    stars = "â­ï¸"; pieces = 480;
                } else if (total <= 115) {
                    stars = "â­ï¸â­ï¸"; pieces = 510;
                } else if (total <= 160) {
                    stars = "â­ï¸â­ï¸â­ï¸"; pieces = 540;
                } else {
                    stars = "â¤ï¸"; pieces = 570;
                }
                // 30% í™•ë¥ ë¡œ ê±°ëŒ€ë‹¹ê·¼ ì¶œë ¥
                if (Math.random() < 0.3) {
                    stars = "ğŸ¥• ê±°ëŒ€ë‹¹ê·¼"; pieces = 1440;
                }
            } else if (item === "í† ë§ˆí† ") {
                if (total <= 60) {
                    stars = "â­ï¸"; pieces = 500;
                } else if (total <= 115) {
                    stars = "â­ï¸â­ï¸"; pieces = 525;
                } else if (total <= 160) {
                    stars = "â­ï¸â­ï¸â­ï¸"; pieces = 550;
                } else {
                    stars = "â¤ï¸"; pieces = 600;
                }
                // 30% í™•ë¥ ë¡œ ë™ì¼ ê°’ ì¶œë ¥
                if (Math.random() < 0.3) {
                    pieces = 600;
                }
            } else if (item === "ê°ì") {
                if (total <= 80) {
                    stars = "â­ï¸"; pieces = 400 * 2; // ë‘ ê°œ
                } else if (total <= 145) {
                    stars = "â­ï¸â­ï¸"; pieces = 500 * 2; // ë‘ ê°œ
                } else if (total <= 190) {
                    stars = "â­ï¸â­ï¸â­ï¸"; pieces = 600 * 2; // ë‘ ê°œ
                } else {
                    stars = "â¤ï¸"; pieces = 700 * 2; // ë‘ ê°œ
                }
            }

            // í˜„ì¬ ë‚ ì§œ ë° ì‹œê°„ ê°€ì ¸ì˜¤ê¸°
            const now = new Date();
            const dateTime = now.toLocaleString(); // "YYYY/MM/DD HH:MM:SS" í˜•ì‹

            // ê°„ë‹¨í•œ ê²°ê´ê°’ ì¶œë ¥
            document.getElementById("result").innerText = `ë¬¼ì£¼ê¸° í•©ê³„: ${waterSum}, ì¡ì´ˆë½‘ê¸° í•©ê³„: ${weedSum}, ë¹„ë£Œ: ${fertilizerSum}, ì˜ì–‘ì œ: ${nutrientSum}, ë‚ ì”¨ ë³´ë„ˆìŠ¤: ${weatherSum}`;
            document.getElementById("finalResult").innerText = `ê²°ê³¼: ${stars}, ë³´ìƒ: ${pieces}í”¼ìŠ¤`;

            // ì‚°ì¶œ ê¸°ë¡ ì €ì¥
            const record = {
                dateTime,
                creator: creatorName,
                player: playerName,
                item,
                waterSum,
                weedSum,
                nutrientSum,
                fertilizerCount,
                total,
                stars,
                pieces,
                waterValues,
                weedValues
            };
            records.push(record);
            localStorage.setItem("records", JSON.stringify(records)); // Local Storageì— ê¸°ë¡ ì €ì¥
            updateRecordDisplay();
        }

        function updateRecordDisplay() {
            const recordDiv = document.getElementById("record");
            recordDiv.innerHTML = ""; // ê¸°ì¡´ ê¸°ë¡ ì œê±°

            // í‘œ ìƒì„±
            const table = document.createElement("table");
            const headerRow = document.createElement("tr");
            headerRow.innerHTML = "<th>ë‚ ì§œ ë° ì‹œê°„</th><th>ì‚°ì¶œì</th><th>í”Œë ˆì´ì–´</th><th>ì‘ë¬¼</th><th>ë¬¼ì£¼ê¸° í•©ê³„</th><th>ì¡ì´ˆë½‘ê¸° í•©ê³„</th><th>ì˜ì–‘ì œ í•©ê³„</th><th>ë¹„ë£Œ íšŸìˆ˜</th><th>ì´í•©</th><th>ê²°ê³¼</th><th>ë¬¼ì£¼ê¸° ê°’</th><th>ì¡ì´ˆë½‘ê¸° ê°’</th>";
            table.appendChild(headerRow);

            records.forEach(record => {
                const row = document.createElement("tr");
                row.innerHTML = `<td>${record.dateTime}</td><td>${record.creator}</td><td>${record.player}</td><td>${record.item}</td><td>${record.waterSum}</td><td>${record.weedSum}</td><td>${record.nutrientSum}</td><td>${record.fertilizerCount}</td><td>${record.total}</td><td>${record.stars}</td><td>${record.waterValues.join(", ")}</td><td>${record.weedValues.join(", ")}</td>`;
                table.appendChild(row);
            });

            recordDiv.appendChild(table);
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ê¸°ë¡ê³¼ ê¸°ë³¸ ì„ íƒ í•­ëª© ì—…ë°ì´íŠ¸
        window.onload = function() {
            updateRecordDisplay(); // ì €ì¥ëœ ê¸°ë¡ í‘œì‹œ
            updateOptions(); // ê¸°ë³¸ ì„ íƒ í•­ëª© ì—…ë°ì´íŠ¸
        };
    </script>
</head>
<body>
    <h1>ë†ì‘ë¬¼ ê³„ì‚°ê¸°</h1>

    <label for="creator">ì‚°ì¶œì:</label>
    <input type="text" id="creator" placeholder="ì‚°ì¶œì ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
    <br><br>

    <label for="player">í”Œë ˆì´ì–´:</label>
    <input type="text" id="player" placeholder="í”Œë ˆì´ì–´ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
    <br><br>

    <label for="item">ì‘ë¬¼ ì„ íƒ:</label>
    <select id="item" onchange="updateOptions()">
        <option value="ì˜¤ì´">ì˜¤ì´</option>
        <option value="ìˆœë¬´">ìˆœë¬´</option>
        <option value="ë¹„íŠ¸">ë¹„íŠ¸</option>
        <option value="ë‹¹ê·¼">ë‹¹ê·¼</option>
        <option value="í† ë§ˆí† ">í† ë§ˆí† </option>
        <option value="ê°ì">ê°ì</option>
    </select>
    <br><br>

    <label for="water">ë¬¼ ì£¼ê¸° íšŸìˆ˜ ì„ íƒ:</label>
    <select id="water">
        <!-- ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•´ ë¹„ì›Œë‘  -->
    </select>
    <br><br>

    <label for="weed">ì¡ì´ˆ ë½‘ê¸° íšŸìˆ˜ ì„ íƒ:</label>
    <select id="weed">
        <!-- ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•´ ë¹„ì›Œë‘  -->
    </select>
    <br><br>

    <label for="fertilizer">ë¹„ë£Œ íšŸìˆ˜ ì„ íƒ:</label>
    <select id="fertilizer">
        <!-- ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•´ ë¹„ì›Œë‘  -->
    </select>
    <br><br>

    <label for="nutrient">ì˜ì–‘ì œ íšŸìˆ˜ ì„ íƒ:</label>
    <select id="nutrient">
        <!-- ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•´ ë¹„ì›Œë‘  -->
    </select>
    <br><br>

    <h3>ë‚ ì”¨ ì„ íƒ:</h3>
    <label for="weather-sunny">ë§‘ìŒ:</label>
    <select class="weather-select" id="weather-sunny">
        <!-- ë‚ ì”¨ ì„ íƒì„ ìœ„í•´ ë¹„ì›Œë‘  -->
    </select>
    <br><br>

    <label for="weather-cloudy">íë¦¼:</label>
    <select class="weather-select" id="weather-cloudy">
        <!-- ë‚ ì”¨ ì„ íƒì„ ìœ„í•´ ë¹„ì›Œë‘  -->
    </select>
    <br><br>

    <label for="weather-thunder">ë²ˆê°œ:</label>
    <select class="weather-select" id="weather-thunder">
        <!-- ë‚ ì”¨ ì„ íƒì„ ìœ„í•´ ë¹„ì›Œë‘  -->
    </select>
    <br><br>

    <button onclick="calculate()">ê²°ê³¼ ê³„ì‚°</button>
    <br><br>

    <h3 id="result"></h3>
    <h3 id="finalResult"></h3>

    <div>
        <span class="toggle-button" onclick="toggleRecord()">ì‚°ì¶œ ê¸°ë¡ ë³´ê¸°</span>
        <div id="record">
            <!-- ì‚°ì¶œ ê¸°ë¡ì´ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤ -->
        </div>
    </div>
</body>
</html>
